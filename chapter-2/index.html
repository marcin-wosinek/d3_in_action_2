<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.8/d3.min.js"
      type="text/JavaScript"
    ></script>
  </head>
  <body>
    <svg></svg>

    <script>
      function dataViz(incomingData) {
        d3.select("body")
          .selectAll("div.cities")
          .data(incomingData)
          .enter()
          .append("div")
          .attr("class", "cities")
          .html(d => d.label);

        var maxPopulation = d3.max(incomingData, d => parseInt(d.values.length));
        var yScale =d3.scaleLinear().domain([0, maxPopulation]).range([0, 460]);
        d3.select('svg').attr('style', 'height: 480px; width:600px');
        d3.select('svg').selectAll('rect')
          .data(incomingData)
          .enter()
          .append('rect')
          .attr('width', 50)
          .attr('height', d => yScale(parseInt(d.values.length)))
          .attr('x', (d, i) => i*60)
          .attr('y', d=> 480-yScale(parseInt(d.values.length)))
          .style("fill", "#FE9922")
          .style("stroke", "#9A8B7A")
          .style("stroke-width", "1px");
      }

      d3.json("tweets.json", (error, data) => {
        if (error) {
          console.error(error);
        } else {
          var tweetData = data.tweets;
          var nestedTweets = d3
            .nest()
            .key(d => d.user)
            .entries(tweetData);

          dataViz(nestedTweets);
        }
      });
    </script>
  </body>
</html>
